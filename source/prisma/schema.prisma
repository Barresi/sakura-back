generator client {
  provider = "prisma-client-js"
}

datasource db {
  url      = env("DB_URL")
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum RequestStatus {
  PENDING
  ACCEPTED
}

enum Gender {
  male
  female
}

model User {
  id            String          @id @default(uuid())
  username      String?         @unique
  firstName     String
  lastName      String
  email         String          @unique
  password      String
  avatar        String?
  banner        String?
  
  city          String?
  birthDate     DateTime?
  gender        Gender?
  description   String?
  
  role          Role            @default(USER)
  friends       Friend[]        @relation("Friends")
  friended      Friend[]        @relation("Friended")
  chats         Chat[]          @relation("Participants")
  messages      Message[]       @relation("Sender")
  notifications Notification[]  @relation("Recipients")
  createdChat   Chat[]
  posts         Post[]
  likedPost     LikedPost[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?
}

model Friend {
  id            String          @id @default(uuid())
  fromId        String
  toId          String
  status        RequestStatus

  from          User            @relation("Friends", fields: [fromId], references: [id])
  to            User            @relation("Friended", fields: [toId], references: [id])

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?

  @@unique([fromId, toId])
}

model Chat {
  id            String          @id @default(uuid())
  participants  User[]          @relation("Participants")
  messages      Message[]       @relation("Messages")
  createdById   String

  createdBy     User            @relation(fields: [createdById], references: [id])

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?
}

model Message {
  id            String          @id @default(uuid())
  senderId      String
  chatId        String

  text          String
  read          Boolean         @default(false)

  sender        User            @relation("Sender", fields: [senderId], references: [id])
  chat          Chat            @relation("Messages" ,fields: [chatId], references: [id])

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?
}

model Notification {
  id            String          @id @default(uuid())
  type          String
  content       String?
  read          Boolean         @default(false)
  recipients    User[]          @relation("Recipients")

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?
}

model Post {
  id            String          @id @default(uuid())
  text          String
  pictures      String[]
  watched       Int?

  createdById   String
  createdBy     User            @relation(fields: [createdById], references: [id])

  likedById     String?
  likedBy       LikedPost[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?
}

model LikedPost {
  likedById     String
  postId        String

  likedBy       User            @relation(fields: [likedById], references: [id])
  post          Post            @relation(fields: [postId], references: [id])

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deleted       DateTime?

  @@unique([likedById, postId])
}